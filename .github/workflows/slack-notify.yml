name: Slack Notify

on:
  push:
    branches:
      - main
      - master

jobs:
  slack-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack webhook
        env:
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
        run: |
          COMMIT_SHORT=$(echo "${{ github.sha }}" | cut -c1-7)

          # Build JSON payload using jq
          jq -n \
            --arg text "ðŸš€ New Push to ${{ github.repository }}" \
            --arg header "ðŸš€ New Push to ${{ github.repository }}" \
            --arg branch "${{ github.ref_name }}" \
            --arg author "${{ github.actor }}" \
            --arg commit "$COMMIT_SHORT" \
            --arg message "$COMMIT_MESSAGE" \
            --arg url "${{ github.event.head_commit.url }}" \
            '{
              "text": $text,
              "blocks": [
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": $header
                  }
                },
                {
                  "type": "section",
                  "fields": [
                    {"type": "mrkdwn", "text": ("*Branch:*\n`" + $branch + "`")},
                    {"type": "mrkdwn", "text": ("*Author:*\n" + $author)},
                    {"type": "mrkdwn", "text": ("*Commit:*\n`" + $commit + "`")}
                  ]
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": ("*Message:*\n" + $message)
                  }
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": ("<" + $url + "|View Changes>")
                  }
                }
              ]
            }' | curl -X POST "$SLACK_WEBHOOK" \
              -H "Content-Type: application/json" \
              -d @-
